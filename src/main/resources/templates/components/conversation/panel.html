<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en"
      th:lang="${#locale.toLanguageTag()}">
<body>
<!--/*@thymesVar id="user" type="com.chat.server.service.user.response.UserInfoResponse"*/-->
<!--/*@thymesVar id="conversation" type="com.chat.server.service.conversation.response.ConversationInfoResponse"*/-->
<div th:fragment="conversation-panel"
     class="flex-1 p-4 sm:p-6 h-full flex flex-col min-h-0"
     id="conversation-panel"
     hx-swap-oob="true"
     th:attr="data-user-id=${user.id}, data-conversation-id=${conversation.id}">
    <div hidden="hidden"
         th:id="'conversation-' + ${conversation.id} + '-read'"
         th:attr="hx-trigger='load, refresh:' + ('conversation-' + ${conversation.id} + '-read') + ' from:body',
              hx-post='/hx/conversations/' + ${conversation.id} + '/read'"
         hx-swap="none"></div>

    <div class="flex flex-col gap-4 h-full min-h-0">
        <div class="conversation-topbar flex items-center justify-between gap-3 border-b pb-3 shrink-0">
            <h2 id="conversation-title"
                class="text-lg sm:text-xl font-semibold text-gray-900 truncate"
                th:text="${conversation.title}">Conversation</h2>
            <button id="conversation-leave-button"
                    th:attr="hx-post='/hx/conversations/' + ${conversation.id} + '/leave',
                             hx-confirm=#{confirm.leave_conversation},
                             title=#{title.leave_chat}"
                    type="button"
                    hx-swap="none"
                    title="Leave this chat"
                    class="inline-flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-700 font-medium px-3 py-1.5 rounded-md text-sm transition-colors"
                    th:text="#{button.leave}">
                Leave
            </button>
        </div>

        <!--/*@thymesVar id="participants" type="java.util.List<com.chat.server.service.conversation.response.ConversationParticipantInfoResponse>"*/-->
        <section id="conversation-participant-list" class="mt-2 shrink-0"></section>
        <div hidden="hidden"
             id="refresh-conversation-participant-list"
             hx-trigger="load, refresh:refresh-conversation-participant-list from:body"
             th:attr="hx-get='/hx/conversations/' + ${conversation.id} + '/participants'"
             hx-swap="none"></div>

        <div hidden="hidden"
             id="initial-loader"
             th:attr="hx-get='/hx/conversations/' + ${conversation.id} + '/before'"
             hx-trigger="load"
             hx-target="#conversation-message-list"
             hx-swap="afterbegin"></div>

        <div id="conversation-message-list"
             class="flex-1 min-h-0 overflow-y-auto border border-gray-200 rounded-lg bg-white p-3"></div>

        <div class="conversation flex items-center gap-2 sm:gap-3 pt-2 shrink-0">
            <label for="conversation-input" class="sr-only"
                   th:text="#{aria.message_input}">Message input</label>
            <input type="text"
                   id="conversation-input"
                   th:placeholder="#{placeholder.conversation.input}"
                   placeholder="Type a message..."
                   class="flex-1 w-full border border-gray-300 rounded-md px-3 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <button id="conversation-send-button"
                    type="button"
                    class="inline-flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-md text-sm sm:text-base transition-colors"
                    th:text="#{button.send}">
                Send
            </button>
        </div>
    </div>
</div>
</body>
</html>
