<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en"
      th:lang="${#locale.toLanguageTag()}">
<body>
<ul th:fragment="friend-list"
    id="search-friend-list"
    hx-swap-oob="true"
    class="divide-y divide-gray-200 text-sm sm:text-base">
    <!--/*@thymesVar id="searchUsers" type="java.util.List<com.chat.server.service.user.response.UserInfoResponse>"*/-->
    <li th:if="${#lists.isEmpty(searchUsers)}"
        class="py-3 text-center text-gray-500"
        th:text="#{ui.friend_search.no_results}">
        No results found.
    </li>

    <li th:each="searchUser : ${searchUsers}"
        class="py-2 flex items-center justify-between">
        <!--/*@thymesVar id="searchUser" type="com.chat.server.service.user.response.UserInfoResponse"*/-->

        <!-- Not a friend yet -->
        <div th:if="${!searchUser.friend}" class="w-full">
            <div type="button"
                    class="w-full flex justify-between items-center bg-blue-50 hover:bg-blue-100 text-blue-800 font-medium px-4 py-2 rounded-md transition-colors">
                <!-- left: avatar + name/account -->
                <div class="flex items-center gap-2 min-w-0">
                    <!-- avatar clickable area -->
                    <div class="shrink-0"
                         th:attr="hx-get='/hx/conversations/friends/' + ${searchUser.id} + '/profile/modal'"
                         hx-swap="none"
                         onclick="event.stopPropagation()">
                        <!-- avatar image -->
                        <img th:if="${searchUser.profileImageUrl != null and !#strings.isEmpty(searchUser.profileImageUrl)}"
                             th:src="${searchUser.profileImageUrl}"
                             alt="User avatar"
                             th:attr="alt=#{aria.user.avatar}"
                             loading="lazy"
                             decoding="async"
                             class="w-8 h-8 rounded-full object-cover border border-blue-200"/>

                        <!-- fallback initial badge -->
                        <div th:if="${searchUser.profileImageUrl == null or #strings.isEmpty(searchUser.profileImageUrl)}"
                             class="w-8 h-8 rounded-full bg-blue-100 text-blue-700 flex items-center justify-center text-xs font-semibold border border-blue-200">
                            <span th:with="
                                      _name=${#strings.isEmpty(#strings.trim(searchUser?.name))
                                               ? #messages.msg('user.unknown')
                                               : searchUser.name},
                                      _first=${#strings.substring(_name, 0, 1)}"
                                  th:text="${#strings.toUpperCase(_first)}">U</span>
                        </div>
                    </div>

                    <!-- name [masked account] -->
                    <span class="truncate"
                          th:text="|${searchUser.name}[${T(com.chat.server.common.util.MaskingUtil).mask(searchUser.accountId)}]|">
                        Name[account]
                    </span>
                </div>

                <!-- right: CTA -->
                <span class="ml-3 text-sm font-semibold"
                      th:text="#{button.add_friend}"
                      th:attr="hx-post='/hx/conversations/friends/' + ${searchUser.id}"
                      th:attrappend="hx-confirm=#{confirm.add_friend}"
                      hx-swap="none">+ Add</span>
            </div>
        </div>

        <!-- Already a friend -->
        <div th:if="${searchUser.friend}" class="w-full">
            <div class="w-full flex justify-between items-center bg-gray-200 text-gray-600 font-medium px-4 py-2 rounded-md cursor-not-allowed">
                <!-- left: avatar + name/account -->
                <div class="flex items-center gap-2 min-w-0">
                    <!-- avatar clickable area -->
                    <div class="shrink-0"
                         th:attr="hx-get='/hx/conversations/friends/' + ${searchUser.id} + '/profile/modal'"
                         hx-swap="none"
                         onclick="event.stopPropagation()">
                        <!-- avatar image -->
                        <img th:if="${searchUser.profileImageUrl != null and !#strings.isEmpty(searchUser.profileImageUrl)}"
                             th:src="${searchUser.profileImageUrl}"
                             alt="User avatar"
                             th:attr="alt=#{aria.user.avatar}"
                             loading="lazy"
                             decoding="async"
                             class="w-8 h-8 rounded-full object-cover border border-gray-300"/>

                        <!-- fallback initial badge -->
                        <div th:if="${searchUser.profileImageUrl == null or #strings.isEmpty(searchUser.profileImageUrl)}"
                             class="w-8 h-8 rounded-full bg-gray-100 text-gray-700 flex items-center justify-center text-xs font-semibold border border-gray-300">
                              <span th:with="
                                       _name=${#strings.isEmpty(#strings.trim(searchUser?.name))
                                                ? #messages.msg('user.unknown')
                                                : searchUser.name},
                                       _first=${#strings.substring(_name, 0, 1)}"
                                    th:text="${#strings.toUpperCase(_first)}">U</span>
                        </div>
                    </div>

                    <!-- name [masked account] -->
                    <span class="truncate"
                          th:text="|${searchUser.name}[${T(com.chat.server.common.util.MaskingUtil).mask(searchUser.accountId)}]|">
                        Name[account]
                    </span>
                </div>

                <!-- right: state label -->
                <span class="ml-3 text-sm font-semibold"
                      th:text="|(${#messages.msg('label.friend')})|">(Friend)</span>
            </div>
        </div>
    </li>
</ul>
</body>
</html>
