<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en"
      th:lang="${#locale.toLanguageTag()}">
<body>
<div th:fragment="friend-list"
     class="flex flex-col min-h-0 h-full"
     hx-swap-oob="true"
     id="sidebar-secondary-content">
    <div hidden="hidden"
         id="refresh-friend-list"
         hx-trigger="refresh:refresh-friend-list from:body"
         hx-get="/hx/conversations/friends"
         hx-swap="none"></div>

    <ul class="divide-y divide-gray-200 text-sm sm:text-base max-h-64 lg:max-h-[60vh] overflow-y-auto pr-1">
        <!--/*@thymesVar id="friends" type="java.util.List<com.chat.server.service.user.response.UserInfoResponse>"*/-->
        <li th:if="${#lists.isEmpty(friends)}"
            class="py-3 text-center text-gray-500"
            th:text="#{ui.friend_list.empty}">
            not exists
        </li>

        <li th:each="friend : ${friends}"
            class="group py-2.5 px-2 sm:px-3 flex items-center gap-3 hover:bg-gray-50 transition-colors cursor-pointer"
            th:attr="hx-post='/hx/conversations/one-to-one/' + ${friend.id} + '/join'"
            hx-swap="none">

            <!-- left: avatar (image if exists; fallback to initial badge) -->
            <div class="shrink-0">
                <!-- Show profile image when exists -->
                <img th:if="${friend.profileImageUrl != null and !#strings.isEmpty(friend.profileImageUrl)}"
                     th:src="${friend.profileImageUrl}"
                     alt="User avatar"
                     loading="lazy"
                     decoding="async"
                     class="w-9 h-9 rounded-full object-cover border border-gray-200"/>

                <!-- Fallback: initial badge when no profile image -->
                <span th:if="${friend.profileImageUrl == null or #strings.isEmpty(friend.profileImageUrl)}"
                      class="inline-flex items-center justify-center w-9 h-9 rounded-full border border-gray-200 bg-gray-50 text-gray-700 text-sm font-semibold">
                    <span th:text="${#strings.substring(friend.name, 0, 1)}">F</span>
                </span>
            </div>

            <!-- middle: name + status/helper line -->
            <div class="flex-1 min-w-0">
                <!-- friend name -->
                <div class="flex items-center gap-2">
                    <span th:text="${friend.name}"
                          class="truncate font-semibold text-gray-900 group-hover:text-gray-900">
                        Chat With Friend
                    </span>
                </div>

                <!-- Status message if present -->
                <div th:if="${friend.statusMessage != null and !#strings.isEmpty(friend.statusMessage)}"
                     class="text-xs text-gray-600 truncate leading-snug"
                     th:text="${friend.statusMessage}">
                    Status message goes here...
                </div>

                <!-- Helper line if no status message (different color) -->
                <div th:if="${friend.statusMessage == null or #strings.isEmpty(friend.statusMessage)}"
                     class="text-xs text-blue-500 truncate leading-snug"
                     th:text="#{ui.friend_list.helper}">
                    Tap to start a 1:1 chat
                </div>
            </div>

            <!-- right: delete button -->
            <button type="submit"
                    class="shrink-0 inline-flex items-center justify-center rounded-full border border-red-200 bg-red-50 text-red-600 hover:bg-red-100 px-2.5 sm:px-3 py-1 text-[11px] sm:text-xs font-semibold focus:outline-none focus:ring-2 focus:ring-red-400/40 transition"
                    th:attr="hx-delete='/hx/conversations/friends/' + ${friend.id}"
                    hx-swap="none"
                    th:attrappend="hx-confirm=#{confirm.delete_friend}"
                    hx-confirm="Are you sure you want to delete this friend?"
                    onclick="event.stopPropagation()"
                    th:text="#{button.delete_friend}">
                Delete
            </button>
        </li>
    </ul>
</div>
</body>
</html>
