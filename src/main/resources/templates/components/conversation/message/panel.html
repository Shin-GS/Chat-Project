<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<body>
<!--/*@thymesVar id="user" type="com.chat.server.service.user.response.UserInfoResponse"*/-->
<!--/*@thymesVar id="conversation" type="com.chat.server.service.conversation.response.ConversationInfoResponse"*/-->
<div th:fragment="conversation-panel"
     class="flex-1 p-4"
     id="conversation-panel"
     hx-swap-oob="true"
     th:attr="data-user-id=${user.id}, data-conversation-id=${conversation.id}">
    <div>
        <div class="conversation-topbar">
            <h2 id="conversation-title" th:text="${conversation.title}">Conversation</h2>
            <button id="conversation-leave-button"
                    th:attr="hx-post='/hx/conversations/' + ${conversation.id} + '/leave'"
                    type="button"
                    hx-swap="none"
                    title="Leave this chat">
                Leave
            </button>
        </div>

        <section th:if="${conversation.type == T(com.chat.server.common.constant.conversation.ConversationType).GROUP}"
                 class="mt-4">
            <!--/*@thymesVar id="participants" type="java.util.List<com.chat.server.service.conversation.response.ConversationParticipantInfoResponse>"*/-->
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-semibold">Participants</h3>
                <span class="text-xs text-gray-500"
                      th:text="${#lists.size(participants)} + ' members'">0 members</span>
            </div>

            <ul class="divide-y divide-gray-200 border rounded">
                <li th:each="participant : ${participants}" class="px-3 py-2 flex items-center justify-between">
                    <span class="font-medium"
                          th:text="|${participant.name}[${#strings.defaultString(participant.role.roleName, participant.role.name())}]|">
                      Name[MEMBER]
                    </span>
                </li>
            </ul>
        </section>

        <div hidden="hidden"
             id="initial-loader"
             th:attr="hx-get='/hx/conversations/' + ${conversation.id} + '/before'"
             hx-trigger="load"
             hx-target="#conversation-message-list"
             hx-swap="afterbegin"></div>

        <div id="conversation-message-list"
             style="height: 400px; overflow-y: auto; border: 1px solid #ccc;"></div>

        <div class="conversation">
            <label for="conversation-input">
                <input type="text"
                       id="conversation-input"
                       placeholder="Type a message..."
                       style="width: 80%;"/>
            </label>
            <button id="conversation-send-button" type="button">Send</button>
        </div>
    </div>
</div>
</body>
</html>
