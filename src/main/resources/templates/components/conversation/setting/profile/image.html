<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      lang="en"
      th:lang="${#locale.toLanguageTag()}">
<body>

<!-- Square profile image preview & uploader (responsive size, no JS; htmx only) -->
<div th:fragment="profile-image-upload (profileImageUrl)"
     id="profile-image-upload"
     class="relative w-28 h-28 sm:w-32 sm:h-32 md:w-36 md:h-36">

    <!-- Square thumbnail container -->
    <div class="group relative w-28 h-28 sm:w-32 sm:h-32 md:w-36 md:h-36 overflow-hidden border border-gray-200 bg-gray-100">

        <!-- Placeholder (only when no image) -->
        <svg th:if="${profileImageUrl == null}"
             xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
             class="absolute inset-0 m-auto w-12 h-12 text-gray-400"
             fill="currentColor" aria-hidden="true">
            <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-3.53 0-10 1.77-10 5.3V22h20v-2.7C22 15.77 15.53 14 12 14Z"/>
        </svg>

        <!-- Actual image (only when url exists) -->
        <img th:if="${profileImageUrl != null}"
             id="avatar-img"
             th:src="${profileImageUrl}"
             class="w-full h-full object-cover"
             alt="Profile image preview"/>

        <!-- Overlay: click to open file chooser (no JS) -->
        <label for="avatar-file"
               class="absolute inset-0 z-0 flex items-center justify-center bg-black/0 group-hover:bg-black/40 focus:bg-black/40 transition-colors cursor-pointer"
               aria-label="Change profile image">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                 class="opacity-0 group-hover:opacity-100 w-8 h-8 text-white transition-opacity"
                 fill="currentColor" aria-hidden="true">
                <path d="M9 2l1.5 2H14l1.5-2H18a2 2 0 0 1 2 2v2H4V4a2 2 0 0 1 2-2h3zM4 8h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8zm8 2.5A3.5 3.5 0 1 0 15.5 14 3.5 3.5 0 0 0 12 10.5zm0-1.5a5 5 0 1 1-5 5 5 5 0 0 1 5-5z"/>
            </svg>
        </label>

        <!-- Top-right Remove (X) button; only when image exists -->
        <button th:if="${profileImageUrl != null}"
                type="button"
                aria-label="Remove profile image"
                class="absolute top-0 right-0 z-10 m-1 w-7 h-7 rounded-full bg-white/90 hover:bg-white border border-gray-300 shadow-sm
                   flex items-center justify-center text-gray-500 hover:text-gray-700
                   focus:outline-none focus:ring-2 focus:ring-blue-500"
                hx-delete="/hx/conversations/setting/upload/profile-image"
                hx-swap="none">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                 fill="currentColor" class="w-4 h-4" aria-hidden="true">
                <path fill-rule="evenodd"
                      d="M10 8.586l3.536-3.536a1 1 0 111.415 1.415L11.414 10l3.536 3.536a1 1 0 01-1.415 1.415L10 11.414l-3.536 3.536a1 1 0 01-1.415-1.415L8.586 10 5.05 6.464A1 1 0 116.464 5.05L10 8.586z"
                      clip-rule="evenodd"/>
            </svg>
        </button>
    </div>

    <!-- Hidden file input; auto-post to hx API on change (preview only) -->
    <input id="avatar-file"
           type="file"
           name="file"
           accept="image/*"
           class="hidden"
           hx-post="/hx/conversations/setting/upload/profile-image"
           hx-encoding="multipart/form-data"
           hx-trigger="change"
           hx-swap="none">
</div>

<!-- Hidden input fragment (include inside the main form); server can also return this OOB -->
<input th:fragment="profile-image-url (profileImageUrl)"
       id="profileImageUrl"
       name="profileImageUrl"
       type="hidden"
       th:value="${profileImageUrl}"/>

</body>
</html>
