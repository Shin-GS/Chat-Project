<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" th:lang="${#locale.toLanguageTag()}">
<body>
<!--/*@thymesVar id="packs" type="java.util.List<com.chat.server.service.conversation.response.ConversationStickerPackResponse>"*/-->
<section th:fragment="sticker-pack-tabs"
         id="conversation-sticker-panel"
         hx-swap-oob="true"
         class="mt-3 border border-gray-200 rounded-lg bg-white/80 p-3 overflow-y-auto">

    <!-- Header -->
    <div class="flex items-center justify-between mb-2">
        <h3 class="text-sm font-semibold text-gray-900">Sticker Packs</h3>
        <div class="flex items-center gap-2">
            <span class="text-xs text-gray-500" th:text="${#lists.size(packs)} + ' packs'">0 packs</span>
            <button type="button"
                    class="text-xs text-gray-600 hover:text-red-600 focus:outline-none"
                    onclick="document.getElementById('conversation-sticker-panel').classList.add('hidden')"
                    aria-label="Close sticker panel">
                Close
            </button>
        </div>
    </div>

    <!-- Horizontal pipe-separated tabs -->
    <nav class="w-full overflow-x-auto whitespace-nowrap" aria-label="Sticker packs">
        <ul id="sticker-pack-tabs"
            class="flex items-center text-sm text-gray-700">
            <li th:if="${#lists.isEmpty(packs)}" class="px-2 py-1 text-gray-500">
                No sticker packs available
            </li>

            <!-- Render tabs with pipe separators -->
            <th:block th:each="pack, iter : ${packs}">
                <li class="inline-flex">
                    <button type="button"
                            class="px-3 py-2 hover:text-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded pack-tab"
                            th:classappend="${iter.index == 0} ? ' text-blue-700 font-semibold' : ''"
                            th:attr="data-pack-id=${pack.id()},
                           data-pack-name=${pack.name() ?: pack.category()},
                           aria-current=${iter.index == 0} ? 'page' : null,
                           hx-get=@{|/hx/conversations/messages/stickers/${pack.id()}|},
                           hx-target='this',
                           hx-swap='none'"
                            title="Open this pack">
                        <span th:text="${pack.name() ?: pack.category()}">Pack</span>
                    </button>
                </li>
                <li th:if="${!iter.last}" class="px-1 select-none text-gray-300">|</li>
            </th:block>
        </ul>
    </nav>

    <!-- Grid container (will be filled via OOB by /stickers/{packId}) -->
    <div id="conversation-sticker-grid"
         class="mt-3 border border-gray-200 rounded-lg bg-white min-h-24 p-3">
        <p class="text-sm text-gray-500">Choose a sticker pack to view its stickers</p>
    </div>

    <!-- Activate panel & mark first tab as selected on arrival -->
    <script>
        (function () {
            // Unhide panel when fragment arrives
            var panel = document.getElementById('conversation-sticker-panel');
            var btn = document.getElementById('open-sticker-panel-btn');
            if (panel) panel.classList.remove('hidden');
            if (btn) btn.setAttribute('aria-expanded', 'true');

            // Client-side active tab styling
            var tabs = document.querySelectorAll('#sticker-pack-tabs .pack-tab');
            tabs.forEach(function (t) {
                t.addEventListener('click', function () {
                    tabs.forEach(function (x) {
                        x.classList.remove('text-blue-700','font-semibold');
                        x.removeAttribute('aria-current');
                    });
                    t.classList.add('text-blue-700','font-semibold');
                    t.setAttribute('aria-current','page');
                });
            });
        })();
    </script>
</section>
</body>
</html>
